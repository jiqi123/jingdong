function ShopCart(){this.arrEditSingleElems=document.querySelectorAll(".edit-mode-in");this.arrEditPckElems=document.querySelectorAll(".pck-edit-mode-in");this.tapEvt="click";this.scrollTopVal=0}ShopCart.prototype={singleProductEdit:function(){for(var a=0;a<this.arrEditSingleElems.length;a++){this.bindEditEvt4Single(this.arrEditSingleElems[a])}},bindEditEvt4Single:function(a){var b=this;a.addEventListener(b.tapEvt,function(d){var c=d||event;var f=b._getPrevious.call(b.getClosestParentByCls.call(this,b,"main-pro-btns"),"cart-product-cell-2");if(null==f){return}pingClick(cartUse,"MShopcartsale_Edit","","","");b.makeNewHTMLByOld(f);c.preventDefault();return false})},pckProductsEdit:function(){for(var a=0;a<this.arrEditPckElems.length;a++){this.bindEditEvt4Pck(this.arrEditPckElems[a])}},bindEditEvt4Pck:function(a){var b=this;a.addEventListener(b.tapEvt,function(f){var c=f||event;var d=b.getClosestParentByCls.call(this,b,"package-items");pingClick(cartUse,"MShopcartsale_Edit","","","");b.addEditOptions(d);c.preventDefault();return false})},makeNewHTMLByOld:function(k){var a,r;var e,j,s,n,h,l="",q="",m=this,f;var g,d,b;var c;g=this.getClosestParentByCls.call(k,this,"items");b=g.querySelector(".editPara")?g.querySelector(".editPara").value:"";d=JSON.parse(b);if(!k){return false}n=k.parentNode;a="";r=k.querySelectorAll(".cart-product-prop span");arrInitProperties=r;for(var o=0;o<r.length;o++){a+=r[o].innerHTML;if(o==0){a+=" "}}e=k.querySelectorAll(".shp-cart-item-price")[0];j=k.querySelector(".cart-product-cell-3 .quantity");s=parseInt(j.value);f=parseInt(d.numAtLeast);if(!isNaN(s)&&s==1){l="disabled"}if(s<=f){l+=" limit-boundary"}if(d.skuNum==d.limitSkuNum||(d.skuNum>=d.remainNumInt&&d.remainNumInt>=0)){q="disabled"}h=document.createElement("div");h.classList.add("edit-pro-mode");h.style.display="none";h.innerHTML=this.getSingleProductHTML({propertiesValue:a,price:e.innerHTML,disabledCls_sub:l,disabledCls_add:q,iProNum:s,skuId:d.skuId,limitSkuNum:d.limitSkuNum,remainNumInt:d.remainNumInt,canExWaBtnShow:d.canExtendedWarrenty,globalAddressSell:d.globalAddressSell,iAtLeastNum:f,isSamPro:d.isSamPro});var p=m._getNext.call(k,"main-pro-btns");n.removeChild(k);n.insertBefore(h,p);h.style.display="block";p.style.display="none";c=h.querySelector(".property-edit-in");oEditArea=c;c.addEventListener("click",function(){var v=this.className;if(v.indexOf("no-sku-switch")!=-1){return false}var u=m.getClosestParentByCls.call(this,m,"items");var i=u.querySelector(".editPara");var t=i?JSON.parse(i.value):{};initSkuInfo=t;m.getSkuList(t.skuId,m.showSkuListDetail,null);m.scrollTopVal=document.body.scrollTop;appendant({maskType:"skuSwitch"});window.removeEventListener("resize",m.skuSwitchUtils().resizePop);window.addEventListener("resize",m.skuSwitchUtils().resizePop);pingClick(cartUse,"MShopcartsale_AttributeEdit","","","","4")});m.bindOptions4MainProd(g,h,k,d)},bindOptions4MainProd:function(m,x,s,a){var u=this,r,w,k,v,t,n,f,p,c,g,h,b;var l,i,o,e,q,d;r=a.shopId;w=a.venderId;k=a.skuId;v=a.suitId;t=a.suitNum;n=a.sType;f=a.skuNum;p=a.venderId;c=a.mainSkuId;g=a.mainSkuNum;h=a.isPure;b=a.numAtLeast;b=parseInt(b);l=x.querySelector(".quantity-increase");i=x.querySelector(".quantity-decrease");o=x.querySelector(".quantity");e=x.querySelector(".del-prod-btn");q=x.querySelector(".extended-warranty-btn");d=x.querySelector(".shop-btn-com .complete-edit-btn");if(l){l.addEventListener(u.tapEvt,function(){if(h){addWareBybutton(p,k)}else{addWareBybutton(p,v,t,n,k,f,g)}})}if(i){i.addEventListener(u.tapEvt,function(){var y=this.className;if(y.indexOf("limit-boundary")!=-1){return}if(h){subWareBybutton(p,k)}else{subWareBybutton(p,v,t,n,k,f)}})}if(o){o.addEventListener("change",function(){var y=parseInt(this.value);if(y<b){$.toast({width:250,message:"\u5546\u54c1\u9650\u8d2d\uff0c\u6700\u5c11\u9700\u8981\u8d2d\u4e70"+b+"\u4ef6\u54e6\u007e",delay:2000,cls:"error-icon"});this.value=b}if(h){modifyWare(p,k)}else{modifyWare(p,v,t,n,k,f)}})}if(e){e.addEventListener(u.tapEvt,function(){if(h){deleteWare(this,r,w,k,f)}else{deleteWare(this,r,w,v,t,n,k,f)}})}if(q){q.addEventListener(u.tapEvt,function(){showChooseYanBao("1",v,t,n,k,f)})}d&&(d.addEventListener(u.tapEvt,j));function j(E){var B,y,D,z,C;C=x.parentNode;z=E||event;y=x.querySelector(".quantity");D=s.querySelectorAll("span.num-cont-show");B=y?y.value:0;pingClick(cartUse,"MShopcartsale_Finish","","","");u.allStyle(D,B);var A=u._getNext.call(x,"main-pro-btns");var F=x.querySelector(".quantity").value;if(typeof(F)!="undefined"){s.querySelector(".quantity").value=F}C.removeChild(x);C.insertBefore(s,A);A.style.display="block";z.preventDefault();return false}},getSingleProductHTML:function(e){var g="",c="",d="",b,a;if(e.canExWaBtnShow&&!e.globalAddressSell==true){g='<a class="cart-new-btn extended-warranty-btn" href="javascript:void(0);">                        <span class="right-boundary"></span>                        <span class="btn-msg-in">\u9009\u670d\u52a1</span></a>'}if(e.isSamPro){a=" sam-price-edit"}else{a=""}if(arrInitProperties[0].innerHTML==""){c="noEditEntry"}else{c=""}b=document.querySelector("#isOpenEditSku");var f=$("#isShowAddFavorite").val()==="true";if(b&&b.value){if("false"==b.value){d="no-sku-switch"}else{d=""}}else{d="no-sku-switch"}return'<div class="property-edit-in '+c+" "+d+'">                <span>'+e.propertiesValue+'</span>                <em class="arrow-down-pro"></em>            </div>            <div class="price-count-edit">                <span class="shp-cart-item-price'+a+'">'+e.price+'</span>                <div class="quantity-wrapper customize-qua">                    <input type="hidden" id="limitSukNum'+e.skuId+'" value="'+e.limitSkuNum+'">                    <input type="hidden" id="remainNumInt'+e.skuId+'" value="'+e.remainNumInt+'">                    <input type="hidden" id="atLeastNum'+e.skuId+'" value="'+e.iAtLeastNum+'">                    <a class="quantity-decrease '+e.disabledCls_sub+'" id="subnum'+e.skuId+'" href="javascript:void(0);"></a>                    <input type="tel" size="4" value="'+e.iProNum+'" name="num" id="num'+e.skuId+'" class="quantity">                    <a href="javascript:void(0);" class="quantity-increase '+e.disabledCls_add+'" id="addnum'+e.skuId+'"></a>                </div>            </div>            <div class="option-btns">                 <div class="shop-btn-com">'+g+(f?'<a class="cart-new-btn atten-move-btn" href="javascript:void(0);"><span class="right-boundary"></span><span class="btn-msg-in">\u79fb\u5165\u5173\u6ce8</span></a>':"")+'                 <a class="cart-new-btn del-prod-btn" href="javascript:void(0);"><span class="right-boundary"></span><span class="btn-msg-in">\u5220\u9664</span></a>                   <a class="cart-new-btn complete-edit-btn" href="javascript:void(0);"><span class="right-boundary"></span><span class="btn-msg-in">\u5b8c\u6210</span></a>              </div>            </div>'},addEditOptions:function(m){var p,g,o,f,l,h,q,s=this;var d,e;d=m.querySelector(".editPara")?m.querySelector(".editPara").value:"";e=JSON.parse(d);p=m.querySelector(".shp-cart-item-abstract .shop-btn-com");q=p.innerHTML;p.innerHTML=this.getShopBtnCom4Pkg();s.computeTitleName(m,".shp-cart-item-abstract .shop-title-content");g=m.querySelectorAll(".items.pck-pro-item");for(var v=0;v<g.length;v++){htmlCartProductCell5=g[v].querySelector(".cart-product-cell-5");var w=g[v].querySelector(".pck-product-canExtendedWarrenty").value;var a=g[v].querySelector(".globalAddressSell").value;if(htmlCartProductCell5){o=htmlCartProductCell5.querySelector(".shop-btn-com")}if(htmlCartProductCell5&&o){var c=o.querySelectorAll(".cart-new-btn");for(var u=0;u<c.length;u++){c[u].classList.add("hide-for-edit");var n=c[u].previousElementSibling||c[u].previousSibling;if(n&&n.nodeType==1){n.classList.add("hide-for-edit")}}var b=htmlCartProductCell5.querySelectorAll(".hide-for-edit");if(b&&b.length){for(var r=0;r<b.length;r++){var t=s.getClosestParentByCls.call(b[r],s,"cart-product-cell-5");t.appendChild(b[r])}}if(s.stringTrim(w)=="true"&&s.stringTrim(a)=="false"){var x=o.querySelectorAll(".cart-new-btn");f=document.createElement("a");f.classList.add("cart-new-btn");f.classList.add("extended-warranty-btn");f.innerHTML='<span class="right-boundary"></span><span class="btn-msg-in">\u9009\u670d\u52a1</span>';f.href="javascript:void(0);";l=o.firstElementChild||o.firstChild;o.insertBefore(f,l)}}else{if(s.stringTrim(w)=="true"&&s.stringTrim(a)=="false"){h=document.createElement("div");h.classList.add("cart-product-cell-5");h.classList.add("main-pro-btns");h.innerHTML='<div class="shop-btn-com"><a class="cart-new-btn extended-warranty-btn" href="javascript:void(0);"><span class="right-boundary"></span><span class="btn-msg-in">\u9009\u670d\u52a1</span></a></div>';g[v].appendChild(h)}else{continue}}}s.bindOptions4PckProd(m,q,e)},bindOptions4PckProd:function(j,q,a){var r=this,o,t,p,k,l,b,f;var e,c;o=a.shopId;h=a.skuId;t=a.suitId;p=a.suitNum;k=a.sType;l=a.venderId;b=a.mainSkuId;f=a.mainSkuNum;e=j.querySelector(".del-prod-btn");c=j.querySelector(".shop-btn-com .complete-edit-btn");if(e){e.addEventListener(r.tapEvt,function(){deleteWare(this,o,l,t,p,k,b,f)})}if(c){g()}function g(){c.addEventListener(r.tapEvt,function(){var i=j.querySelector(".shp-cart-item-abstract .shop-btn-com");var u=j.querySelectorAll(".items.pck-pro-item .cart-product-cell-5 .shop-btn-com");pingClick(cartUse,"MShopcartsale_Finish","","","");r.clearExtendedWarrentyBtns(u);i.innerHTML=q;r.computeTitleName(j,".shp-cart-item-abstract .shop-title-content");r.bindEditEvt4Pck(j.querySelectorAll(".shp-cart-item-abstract .shop-btn-com .pck-edit-mode-in")[0])})}var m=j.querySelectorAll(".items.pck-pro-item");for(var s=0;s<m.length;s++){var n=m[s].querySelector(".shop-btn-com .extended-warranty-btn");if(!n){continue}var h=m[s].querySelector(".pck-product-id").value;var d=m[s].querySelector(".pck-product-num").value;(function(u,i){n.addEventListener(r.tapEvt,function(){showChooseYanBao("1",t,p,k,u,i)})})(h,d)}},clearExtendedWarrentyBtns:function(d){var a,f;for(var c=0;c<d.length;c++){a=d[c].parentNode;d[c].innerHTML="";var e=a.querySelectorAll(".hide-for-edit");if(e&&e.length){for(var b=0;b<e.length;b++){d[c].appendChild(e[b]);e[b].classList.remove("hide-for-edit")}}else{a.parentNode.removeChild(a)}f=d[c].querySelectorAll(".cart-new-btn").length}},getPkgProductHTML:function(a){return'<input type="hidden" id="limitSukNum'+a.suitId+'" value="'+a.limitSkuNum+'">                <input type="hidden" id="remainNumInt'+a.suitId+'" value="'+a.remainNumInt+'">                <a class="quantity-decrease '+a.disabledCls_sub+'" id="subnum'+a.suitId+'" href="javascript:void(0);"></a>                <input type="tel" size="4" value="'+a.number+'" name="num" id="num'+a.suitId+'" class="quantity">                <a class="quantity-increase '+a.disabledCls_add+'" id="addnum'+a.suitId+'" href="javascript:void(0);"></a>'},getShopBtnCom4Pkg:function(){return'<a class="cart-new-btn del-prod-btn" href="javascript:void(0);"><span class="right-boundary"></span><span class="btn-msg-in">\u5220\u9664</span></a>                <a class="cart-new-btn complete-edit-btn" href="javascript:void(0);"><span class="right-boundary"></span><span class="btn-msg-in">\u5b8c\u6210</span></a>'},getClosestParentByCls:function(d,a){var c=this.parentNode;if(c.nodeName.toUpperCase()=="HTML"){return null}var b=c.classList;if(d.isClassInArr(a,b)){return c}else{return d.getClosestParentByCls.call(c,d,a)}},stringTrim:function(a){return a.replace(/(^\s*)|(\s*$)/g,"")},isClassInArr:function(a,b){if(!b||!b.length){return false}for(var c=0;c<b.length;c++){if(b[c]==a){return true}}return false},allStyle:function(b,a){for(var d=0;d<b.length;d++){if(typeof a=="object"){for(var c in a){b[d].style[c]=a[c]}}else{if(typeof a=="string"){b[d].innerHTML=a}}}},isEmptyObject:function(b){var a;for(a in b){return false}return true},computeTitleName:function(c,g){g=g||".shop-title-content";c=c||document;var h=c.querySelectorAll(g);var f,e,a,d,k,j;for(var b=0;b<h.length;b++){f=h[b].offsetWidth;e=h[b].nextElementSibling||h[b].nextSibling;d=h[b].children[0];j=h[b].children[1];a=e.offsetWidth?e.offsetWidth:0;k=d.offsetWidth?d.offsetWidth:0;j.style.maxWidth=(f-a-k)+"px"}},_setStrAutoWidth:function(c,e){var g,i,b=10000;var f=document.querySelector(c);var d=f.textContent;if(e){d="? ?"+d}var a;g=this.getDataSetValue(f,"fsizeinit");if(!g){g=this.getStyleValue(f,"fontSize")}i=g?parseInt(g):0;a=i;var h=f.parentNode.offsetWidth;if(!h){return}b=this._getStrOriginalWidth(d,i);while(h<=b){b=this._getStrOriginalWidth(d,i);a=i--}if(a==0){a=9}f.style.fontSize=a+"px"},getStyleValue:function(b,a){if(b.currentStyle){return b.currentStyle[a]}else{return getComputedStyle(b,false)[a]}},getDataSetValue:function(b,a){if(b){return b.dataset[a]}else{return""}},_getStrOriginalWidth:function(c,b){var d=0;if(c){var a=document.getElementById("_getWidthID");if(!a){a=document.createElement("span");a.id="_getWidthID";document.body.appendChild(a);a.style.visibility="hidden";a.style.whiteSpace="nowrap";a.style.display="inline"}a.innerText=c;a.style.fontSize=b+"px";d=a.offsetWidth}a.parentNode.removeChild(a);return d},popMoneyNotEnough:function(){var b=document.querySelectorAll(".shop-btn-com.promo-spc .cart-new-btn"),d=this;for(var c=0,a=b.length;c<a;c++){b[c].addEventListener("click",function(l){var f=l||event;var k=this.className;if(k.indexOf("disabled-act-btn")!=-1){var i=document.querySelector("#shopping"+this.dataset.key).getAttribute("onclick");var m=i.lastIndexOf(",")+2;var j=i.length-2;var h=i.substring(m,j);var g;popMessage2({callback:function(e){if(e){}else{}},activity:"popActBuyMore",description:"\u60a8\u9009\u4e2d\u7684\u5546\u54c1\u91d1\u989d\u8fd8\u4e0d\u591f\u54e6\uff01",cancelText:"\u77e5\u9053\u4e86",saveText:"\u53bb\u51d1\u5355",methodValue:i})}f.preventDefault();return false})}},getSkuList:function(c,a,e){var f=this;var b=$("#sid").val();var d="/cart/editSku.json?skuId="+c+"&sid="+b;$.ajax({url:d,timeout:2000,success:function(g){a&&a.call(f,g,e)},error:function(g,i,h){console.log("XMLHttpRequest.status--->"+g.status+"  XMLHttpRequest.readyState--->"+g.readyState);a&&a.call(f,null,e)}})},skuSwitchEvts:function(e){var l=document.querySelector("#mask-con");var c=document.querySelectorAll("#editSkuBtns a");var b=document.querySelector("#refreshBtn");var k=this;var d=document.querySelectorAll(".property-vals");for(var h=0,g=d.length;h<g;h++){(function(m){for(var n=0,i=m.length;n<i;n++){m[n].addEventListener("click",function(){if(this.className.indexOf("seled")==-1){for(var j=0;j<i;j++){m[j].classList.remove("seled")}this.classList.add("seled");k.skuSwitchUtils().switchPropertyLogic(this);l.style.top=(1-l.offsetHeight)+"px";k.skuSwitchUtils().updateSeledDisplay();pingClick(cartUse,"MShopcartsale_AttributeParam","","","","")}})}})(d[h].querySelectorAll("a"))}if(e){for(var f=0,a=c.length;f<a;f++){c[f].removeEventListener("click",k.skuSwitchUtils().btnResponse);c[f].addEventListener("click",k.skuSwitchUtils().btnResponse)}}if(b){b.addEventListener("click",function(){k.getSkuList(k.skuSwitchUtils().getInitSkuObj().skuId,k.showSkuListDetail,null)})}},skuSwitchUtils:function(){var a=this;return{findSkuIdOfColorSizeSpec:function(c,e,g,d){if(e!=""&&g!=""&&d!=""){for(var f=0;f<c.length;f++){var b=c[f];if(b.color==e&&b.size==g&&b.spec==d){return b.skuId}}}else{if(e!=""&&g!=""){for(var f=0;f<c.length;f++){var b=c[f];if(b.color==e&&b.size==g){return b.skuId}}}else{if(e!=""&&d!=""){for(var f=0;f<c.length;f++){var b=c[f];if(b.color==e&&b.spec==d){return b.skuId}}}else{if(g!=""&&d!=""){for(var f=0;f<c.length;f++){var b=c[f];if(b.size==g&&b.spec==d){return b.skuId}}}else{if(e!=""){for(var f=0;f<c.length;f++){var b=c[f];if(b.color==e){return b.skuId}}}else{if(g!=""){for(var f=0;f<c.length;f++){var b=c[f];if(b.size==g){return b.skuId}}}else{if(d!=""){for(var f=0;f<c.length;f++){var b=c[f];if(b.spec==d){return b.skuId}}}}}}}}}return""},switchPropertyLogic:function(g){var k=skuData.wareInfo.skuColorSize.currentColorSize;var p=skuData.wareInfo.skuColorSize;k[g.parentNode.dataset.protype]=g.innerHTML;var o=g.parentNode.dataset.protype;var b=k.colorName?k.colorName:"";var m=k.sizeName?k.sizeName:"";var j=k.specName?k.specName:"";var d=[];var n=[];var f=[];var l;var h,e;if(!!o&&o=="colorName"){h="";e=this.checkWhetherAllSeld();if(!e||!e.length){h=this.findSkuIdOfColorSizeSpec(p.colorSize,b,m,j)}if(h!=""){a.getSkuList(h,a.showSkuListDetail,g)}else{m=this.findCurrentValue(p.colorSize,m,b,o);j=this.findCurrentValue(p.colorSize,j,b,o);for(var c=0;c<p.colorSize.length;c++){l=p.colorSize[c];if(d.indexOf(l.color)<0){d.push(l.color)}if(l.color==b){if(m==""&&j==""){if(n.indexOf(l.size)<0){n.push(l.size)}if(f.indexOf(l.spec)<0){f.push(l.spec)}}else{if(!!m){if(n.indexOf(l.size)<0){n.push(l.size)}if(l.size==m){if(f.indexOf(l.spec)<0){f.push(l.spec)}}}else{if(!!j){if(f.indexOf(l.spec)<0){f.push(l.spec)}if(l.spec==j){if(n.indexOf(l.size)<0){n.push(l.size)}}}}}}}document.querySelector("#editSkuBtns").classList.remove("disabled-btn")}}if(!!o&&o=="sizeName"){h="";e=this.checkWhetherAllSeld();if(!e||!e.length){h=this.findSkuIdOfColorSizeSpec(p.colorSize,b,m,j)}if(h!=""){a.getSkuList(h,a.showSkuListDetail,g)}else{b=this.findCurrentValue(p.colorSize,b,m,o);j=this.findCurrentValue(p.colorSize,j,m,o);for(var c=0;c<p.colorSize.length;c++){l=p.colorSize[c];if(n.indexOf(l.size)<0){n.push(l.size)}if(l.size==m){if(b==""&&j==""){if(d.indexOf(l.color)<0){d.push(l.color)}if(f.indexOf(l.spec)<0){f.push(l.spec)}}else{if(!!b){if(d.indexOf(l.color)<0){d.push(l.color)}if(l.color==b){if(f.indexOf(l.spec)<0){f.push(l.spec)}}}else{if(!!j){if(f.indexOf(l.spec)<0){f.push(l.spec)}if(l.spec==j){if(d.indexOf(l.color)<0){d.push(l.color)}}}}}}}document.querySelector("#editSkuBtns").classList.remove("disabled-btn")}}if(!!o&&o=="specName"){h="";e=this.checkWhetherAllSeld();if(!e||!e.length){h=this.findSkuIdOfColorSizeSpec(p.colorSize,b,m,j)}if(h!=""){a.getSkuList(h,a.showSkuListDetail,g)}else{b=this.findCurrentValue(p.colorSize,b,j,o);m=this.findCurrentValue(p.colorSize,m,j,o);for(var c=0;c<p.colorSize.length;c++){l=p.colorSize[c];if(f.indexOf(l.spec)<0){f.push(l.spec)}if(l.spec==j){if(b==""&&m==""){if(d.indexOf(l.color)<0){d.push(l.color)}if(n.indexOf(l.size)<0){n.push(l.size)}}else{if(!!b){if(d.indexOf(l.color)<0){d.push(l.color)}if(l.color==b){if(n.indexOf(l.size)<0){n.push(l.size)}}}else{if(!!m){if(n.indexOf(l.size)<0){n.push(l.size)}if(l.size==m){if(d.indexOf(l.color)<0){d.push(l.color)}}}}}}}document.querySelector("#editSkuBtns").classList.remove("disabled-btn")}}skuData.wareInfo.skuColorSize.currentColorSize.colorName=b;skuData.wareInfo.skuColorSize.currentColorSize.sizeName=m;skuData.wareInfo.skuColorSize.currentColorSize.specName=j;this.updateProDisplay("colorName",d);this.updateProDisplay("sizeName",n);this.updateProDisplay("specName",f);this.resetSelectedStatus(k)},findCurrentValue:function(c,f,e,g){if(f!=""){g=g.substring(0,g.length-4);for(var d=0;d<c.length;d++){var b=c[d];if(b[g]==e){if((!!b.color&&b.color==f)||(!!b.size&&b.size==f)||(!!b.spec&&b.spec==f)){return f}}}return""}return""},updateProDisplay:function(g,e){var f=document.querySelector("p[data-protype="+g+"]");if(f&&e&&e.length){var d="";for(var c=0,b=e.length;c<b;c++){d+='<a href="javascript:void(0);" class="">'+e[c]+"</a>"}f.innerHTML=d}},computeScrollHei:function(e){if(!!!e){return false}var g=i(e);function i(k){var n=k.innerHTML,m=k.parentNode.dataset.protype,l=document.querySelector("p[data-protype="+m+"] a.seled");return l}var d=document.querySelector(".sku-properties-switch");if(!d){return false}var h=document.querySelector("#pointWin");var c=d.scrollHeight;var j=h.offsetHeight;var f=g.offsetTop;var b=g.offsetHeight;if(c>j){if((b+f)>j){h.scrollTop=f-j+b}}},resetSelectedStatus:function(b){for(value in b){var f=document.querySelector("p[data-protype="+value+"]");if(!f){continue}var c=f.querySelectorAll("a");for(var d=0,e=c.length;d<e;d++){if(b[value]&&b[value]==c[d].innerHTML){c[d].classList.add("seled")}}}a.skuSwitchEvts(false)},checkWhetherAllSeld:function(){var f=document.querySelectorAll(".sku-properties-switch .property-vals");var e=document.querySelectorAll(".sku-properties-switch .property-vals a.seled");var d=f.length,h=e.length,c=[];if(f&&e&&d>h){for(var g=0;g<d;g++){var b=f[g].querySelector("a.seled");if(!!!b){c.push(f[g].dataset.typename)}}}return c},btnResponse:function(e){var b=e||event;var h=b.srcElement||b.target;var g=h.classList.toString();if(g.indexOf("cancel-btn")!=-1){appendant().retractMask();window.scrollTo(0,a.scrollTopVal);pingClick(cartUse,"MShopcartsale_Cancel","","","","")}else{var d=h.parentNode.className;if(d.indexOf("disabled-btn")!=-1){pingClick(cartUse,"MShopcart_UnableConfirm","","","","");return false}var f=a.skuSwitchUtils().checkWhetherAllSeld();if(f&&f.length){$.toast({width:186,message:"\u8bf7\u9009\u62e9"+f.toString()+"\u5c5e\u6027",delay:2000,cls:"error-icon",specialCls:"position-special"});return false}var c=a.skuSwitchUtils().getInitSkuObj();var i=a.skuSwitchUtils().getCurrentSkuId();if(c.skuId==i){appendant().retractMask();window.scrollTo(0,a.scrollTopVal)}else{a.skuSwitchUtils().addSkuToCart(i)}pingClick(cartUse,"MShopcartsale_Confirm","","","","")}},addSkuToCart:function(e){var d=$("#sid").val();var c="/cart/add.json?wareId="+e+"&sid="+d;var b=this;jQuery.get(c,{},function(g){if(!!g&&!!g.cart){var h=g.cart;var f=h.resultCode;if(f==0){b.deleteCurrentSku()}else{$.toast({width:186,message:"\u51fa\u9519\u4e86\uff0c\u8bf7\u91cd\u65b0\u4fee\u6539~",delay:2000,cls:"error-icon"});appendant().retractMask();window.scrollTo(0,a.scrollTopVal)}}else{$.toast({width:186,message:"\u51fa\u9519\u4e86\uff0c\u8bf7\u91cd\u65b0\u4fee\u6539~",delay:2000,cls:"error-icon"});appendant().retractMask();window.scrollTo(0,a.scrollTopVal)}})},deleteCurrentSku:function(){var d=this.getInitSkuObj();var e=d.shopId;var c=d.skuId;var b=d.skuNum;var g=d.suitId;var f=d.suitNum;var h=d.sType;if(d.isPure){directDeleteWare(e,c,b)}else{directDeleteWare(e,g,f,h,c,b)}},initHeight:function(){var c=document.documentElement.clientHeight;var b={minHeight:Math.ceil(1/3*c),maxHeight:Math.ceil(2/3*c)};document.body.style.height=document.documentElement.clientHeight+"px";var d=document.querySelector("#skuCommodityInfo").offsetHeight+document.querySelector("#editSkuBtns").offsetHeight;document.querySelector("#pointWin").style.maxHeight=b.maxHeight-d+"px";document.querySelector("#pointWin").style.minHeight=b.minHeight-d+"px"},resizePop:function(){var b=document.querySelector("#mask-con");a.skuSwitchUtils().initHeight();b.style.top=(1-b.offsetHeight)+"px"},getInitSkuObj:function(){return initSkuInfo},getCurrentSkuId:function(){return skuData.wareInfo.wareId},processPrice:function(b){var c,d,f,e;c=/^\D?(\d+)(\.\d{2})\d*\D*$/;f=b.replace(c,"$1");e=b.replace(c,"$2");return"<strong>"+f+"</strong>"+e},producePopHTML:function(){var j="",e="\u5df2\u9009\uff1a",q,k,t,g,u,c;var f="",n="";if(skuData&&!!skuData.wareInfo&&skuData.wareInfo.code=="0"){q=skuData.wareInfo.skuColorSize;k=q.currentColorSize;for(value in k){e+=k[value];e+=" / "}e=e.substring(0,e.length-3);if(skuData.wareInfo.stockStatus=="\u65e0\u8d27"){n='<i class="no-stocking-icon"></i>';f="no-stock-opacity"}j='<div class="edit-sku-con"><div id="skuCommodityInfo" class="sku-commodity-info"><span class="sku-pic-part"><img src="'+skuData.wareInfo.image.replace("http:","")+'" alt="" class="sku-img '+f+'"/>'+n+'</span><div class="sku-msg"><span class="sku-commodity-price"><span class="shp-cart-item-price">&yen;'+this.processPrice(skuData.wareInfo.price)+'</span></span><span class="sku-properties">'+e+'</span></div><div class="clear-fl"></div></div><div class="divide-line"></div><div class="point-win" id="pointWin"><div class="sku-properties-switch">';if(!q||a.isEmptyObject(q)){for(var s=0,l=arrInitProperties.length;s<l;s++){var m=arrInitProperties[s].innerHTML;var d=m.split(":");var b=d[0];d.shift();var o=d.toString();j+='<div class="property-key">'+b+'</div><p class="property-vals" data-protype="" data-typename="'+b+'"><a href="javascript:void(0);" class="seled">'+o+"</a></p>"}}else{t=skuData.wareInfo.skuColorSize.colorSizeTitle;g=skuData.wareInfo.skuColorSize.colorSizeContent;u=skuData.wareInfo.skuColorSize.currentColorSize;c=skuData.wareInfo.cartFlag?"":"disabled-btn";var v={},w={};t.colorName&&(v.colorName=t.colorName);t.sizeName&&(v.sizeName=t.sizeName);t.specName&&(v.specName=t.specName);g.colorName&&(w.colorName=g.colorName);g.sizeName&&(w.sizeName=g.sizeName);g.specName&&(w.specName=g.specName);for(title in v){j+='<div class="property-key">'+v[title]+'</div><p class="property-vals" data-protype="'+title+'" data-typename="'+v[title]+'">';for(var p=0,r=w[title].length;p<r;p++){if(u[title]==w[title][p]){j+='<a href="javascript:void(0);" class="seled">'+w[title][p]+"</a>"}else{j+='<a href="javascript:void(0);">'+w[title][p]+"</a>"}}j+="</p>"}}j+="</div>"}else{j='<div class="edit-sku-con"><div id="skuCommodityInfo" class="sku-commodity-info"><span class="sku-pic-part"><img src="" alt="" class="sku-img"></span><div class="sku-msg"><span class="sku-commodity-price"><span class="shp-cart-item-price"></span></span><span class="sku-properties"></span></div><div class="clear-fl"></div></div><div class="point-win" id="pointWin" style="height: 118px; top: -59px;"><div class="error-msg-block"><div class="error-txt-msg">\u6570\u636e\u83b7\u53d6\u5931\u8d25</div><div class="error-txt-msg2">\u8bf7\u70b9\u51fb\u91cd\u65b0\u5237\u65b0</div><div class="btnCls-shop-cart" id="refreshBtn">\u5237\u65b0</div></div>';c="disabled-btn"}j+='</div></div><div id="editSkuBtns" class="edit-sku-btns '+c+' box-flex-f"><a href="javascript:void(0);" class="btn cancel-btn box-flex-c">\u53d6\u6d88</a><a href="javascript:void(0);" class="btn ensure-btn box-flex-c">\u786e\u5b9a</a></div>';return j},updateSeledDisplay:function(){var f=document.querySelector("#skuCommodityInfo .sku-properties");var e=document.querySelectorAll(".sku-properties-switch p.property-vals a.seled");var b="\u5df2\u9009\uff1a";for(var c=0,d=e.length;c<d;c++){b+=e[c].innerHTML;b+=" / "}b=b.substring(0,b.length-3);f.innerHTML=b}}},showSkuListDetail:function(e,f){skuData=e;var c=document.querySelector("#mask-con");var g=this,d,b=g.skuSwitchUtils().producePopHTML();c.innerHTML=b;var a=c.querySelector(".sku-pic-part .sku-img");a.addEventListener("click",function(){pingClick(cartUse,"MShopcartsale_ProductPic","","","","")});g.skuSwitchUtils().initHeight();d=document.querySelector("#mask-con");d.style.top=(1-d.offsetHeight)+"px";g.skuSwitchEvts(true);g.skuSwitchUtils().computeScrollHei(f)},dealWithHash:function(){setTimeout(function(){var c=window.location.hash;if(c&&c!=""&&c!="#"&&c!="_"){var b="product"+c;b=b.replace("#","");var a=document.querySelector("#"+b);if(a){document.body.scrollTop=a.offsetTop-79}window.location.hash="_"}},500)},showPopWin:function(a){pingClick(cartUse,"MShopcart_ChangeDiscount","","","");var c="\u4fee\u6539\u4fc3\u9500\u4f18\u60e0";var b={interateData:function(){var e='<div class="contain-pop-wrap"><div class="pop-win-head"><span class="pop-win-title">'+c+'</span><a class="close-icn" id="closeIcn"></a></div><ul class="pop-record-ul" id="popRecordUl">',h="</ul></div>",f;var l="",j,i;for(var d=0,g=a.promotions.length;d<g;d++){j=a.promotions[d];if(j.id==-300){continue}i=j.checkType==1?"checked":"";j.title=j.title||"";l+='<li data-id="'+j.id+'"><div class="activity-part"><span class="cart-checkbox active-radio '+i+'"></span><span class="condition-description"><span class="two-linemax">'+j.title+"</span></span></div></li>"}f=e+l+h;krystal.layerBottom.init({html:f,maxRatio:1/2,closeEle:"#closeIcn",closeFn:function(){pingClick(cartUse,"MShopcart_ChangeDiscountClose","","","")},extraSpace:30,scrollElement:"#popRecordUl"});this.bindEvts()},bindEvts:function(){var k=this;var e=krystal.layerBottom.getScrollContainer();var g=e.querySelectorAll("#popRecordUl>li");var j=e.querySelectorAll(".activity-part .active-radio");var f;for(var h=0,d=g.length;h<d;h++){g[h].addEventListener("click",function(){f=this.querySelector(".activity-part .active-radio");var l=f.className;if(l.indexOf("checked")<0){for(var i=0,m=j.length;i<m;i++){j[i].classList.remove("checked")}f.classList.add("checked");delete a.promotions;a.activePromotionId=this.dataset.id;k.submitData(a)}else{krystal.layerBottom.closeBox(false)}},false)}},submitData:function(d){var g=this,f="/cart/changePromotion.json?"+this._transferJson2Para(d)+"sid="+$("#sid").val();pingClick(cartUse,"MShopcart_ChangeDiscountBenefit","","","");var e=false;$.ajax({url:f,timeout:3000,success:function(h){if(h&&h.cart&&h.cart.resultCode==0){window.location.hash=d.skuId;e=true}},error:function(h,j,i){if(j=="timeout"){e=true}else{console.log(j)}},complete:function(){krystal.layerBottom.closeBox(e)}})},_transferJson2Para:function(e){var d="";for(name in e){d+=name+"="+e[name];d+="&"}return d}};b.interateData()},_getPrevious:function(b){var a=this.previousElementSibling||this.previousSibling;if(a.className.indexOf(b)!=-1){return a}return null},_getNext:function(b){var a=this.nextElementSibling||this.nextSibling;if(a.className.indexOf(b)!=-1){return a}return null}};function transferStr2Unicode(h){var g,f,d,a=[],b;for(var i=0,e=h.length;i<e;i++){g=h.charCodeAt(i);f=g.toString(16);switch(f.length){case 1:f="000"+f;break;case 2:f="00"+f;break;case 3:f="0"+f;break}d="\\u"+f;a.push(d)}var b=a.join("");return b}function processPrice(a){var b,c,e,d;b=/^.*(\D)(\d*)(\.\d{2})\d*\D*$/;c=a.replace(b,"$1");e=a.replace(b,"$2");d=a.replace(b,"$3");return c+"<strong>"+e+"</strong>"+d}(function(c){c.fn.toast=function(d){return new b(this[0],d)};var a=0;var b=(function(){var d=function(f,e){if(typeof f==="string"||f instanceof String){this.container=document.getElementById(f)}else{this.container=f}if(!this.container){console.log("error finding container for toast "+f);return}if(typeof(e)==="string"||typeof(e)==="number"){e={message:e}}this.styleType=e.styleType||1;this.cls=e.cls?e.cls:"";this.titleName=e.titleName||"";this.subtitle=e.subtitle||"";this.message=e.message||"";this.delay=e.delay||this.delay;this.maxHeight=e.maxHeight?e.maxHeight:this.maxHeight;this.minHeight=e.minHeight?e.minHeight:this.minHeight;this.okCallback=e.okCallback?e.okCallback:this.okCallback;this.btns=e.btns?e.btns:this.btns;this.okBtnId=e.okBtnId?e.okBtnId:this.okBtnId;this.txtAlign=e.txtAlign?e.txtAlign:this.txtAlign;this.btnNum=e.btnNum?e.btnNum:this.btnNum;this.listContainer=e.listContainer?e.listContainer:this.listContainer;this.messageColor=e.messageColor?e.messageColor:this.messageColor;this.btnsReverse=e.btnsReverse?e.btnsReverse:false;this.cancelCallback=e.cancelCallback?e.cancelCallback:false;this.multiSkipLink=e.multiSkipLink?e.multiSkipLink:false;this.willClosePop=e.willClosePop?e.willClosePop:true;this.upVal=e.upVal?e.upVal:this.upVal;this.autoClose=d.judgeOptsValFn(e.autoClose,this.autoClose);this.hasBtns=d.judgeOptsValFn(e.hasBtns,this.hasBtns);this.islimitHeight=d.judgeOptsValFn(e.islimitHeight,this.islimitHeight);this.isMaskClose=d.judgeOptsValFn(e.isMaskClose,this.isMaskClose);this.hasCloseBtn=d.judgeOptsValFn(e.hasCloseBtn,this.hasCloseBtn);this.whiteBg=d.judgeOptsValFn(e.whiteBg,this.whiteBg);this.iskeyboardT=d.judgeOptsValFn(e.iskeyboardT,this.iskeyboardT);this.container=c(this.container);if(this.container.find(".mjdToastContainer").length===0){this.container.append("<div class='mjdToastContainer'></div>")}this.container=this.container.find(".mjdToastContainer");this.container.removeClass("tr tb br tl tc bc");if(a==0){this.show()}};d.prototype={cls:null,titleName:null,subtitle:null,message:null,delay:2000,styleType:1,el:null,container:null,listContainer:null,timer:null,autoClose:true,isMaskClose:true,scrollH:"",bodyH:"",maxHeight:0,minHeight:52,islimitHeight:true,hasBtns:true,btns:{cancelTxt:"\u53d6\u6d88",okTxt:"\u63d0\u4ea4"},txtAlign:"left",btnNum:0,hasCloseBtn:false,whiteBg:false,messageColor:null,iskeyboardT:false,upVal:0,okBtnId:"okBtn",okCallback:function(){},cancelCallback:function(){},show:function(){var e=this;var h=this.addHtml();this.el=c(h).get(0);this.container.append(this.el);var g=c(e.el);var i=g.find(".message-box");a++;if(e.listContainer!=null){var f=c(e.listContainer);e.bodyH=f.height();e.scrollH=document.body.scrollTop}e.setEvent(g);e.transformFn(g);if(e.styleType==1){e.islimitHeight=false}if(e.islimitHeight){e.setBody(1)}if(e.autoClose){e.timer=setTimeout(function(){e.hide()},this.delay)}if(e.iskeyboardT){e.setBody(1);if(e.upVal){i.css("marginTop",e.upVal)}}},setEvent:function(f){var e=this;switch(e.styleType){case 1:if(e.isMaskClose){f.bind("click",function(){e.hide()})}break;case 2:if(e.btnNum==1){c(".one-btn-tip-btn").bind("click",function(){e.hide()});c(".one-btn-tip-btn").bind("touchstart",function(){})}else{if(e.btnNum==2){c(".btn-close").bind("click",function(){if(e.multiSkipLink){e.cancelCallback()}if(e.willClosePop){e.hide()}});c(".btn-close").bind("touchstart",function(){});c(".btn-sure").bind("click",function(){e.okCallback();if(e.willClosePop){e.hide()}});c(".btn-sure").bind("touchstart",function(){})}}if(e.hasCloseBtn){c(".rt-close-btn-wrap").bind("click",function(){e.hide()});c(".rt-close-btn-wrap").bind("touchstart",function(){})}break;default:break}},transformFn:function(h){var e=this;var g=h.find(".message-txt");var f=h.find(".txt-max-height");var i=h.find(".message-txt-wrapper");if(e.txtAlign){g.css("textAlign",e.txtAlign)}if(e.maxHeight>0){f.css({maxHeight:e.maxHeight,overflow:"auto"})}if(!e.titleName){i.css("minHeight",e.minHeight)}},setBody:function(h){var f=this;var e=document.documentElement.clientHeight;var g=c(f.listContainer);if(h==1){g.css({height:e,overflow:"hidden"})}else{if(h==2){g.css({height:f.bodyH,overflow:""});document.body.scrollTop=f.scrollH}}},hide:function(){var e=this;if(e.islimitHeight){e.setBody(2)}if(e.iskeyboardT){e.setBody(2)}if(e.timer!=null){clearTimeout(e.timer)}e.remove()},remove:function(){var e=c(this.el);e.remove();a=0},addHtml:function(){var f=this;var e="";switch(f.styleType){case 1:e='<div class="shade-floor">';if(f.whiteBg){e+='<div class="cover-floor"></div>';e+='<div class="message-box content-box whiteBg-box">'}else{e+='<div class="message-box content-box">'}if(f.cls){e+='<div class="message-box-icon"><i class="message-icon '+f.cls+'"></i></div>'}e+='<div class="message-box-content txt-align txt-max-height">'+f.message+"</div>";e+="</div>";e+="</div>";break;case 2:e+='<div class="shade-floor">';e+='<div class="cover-floor"></div>';e+=' <div class="choose-box content-box">';e+='   <div class="message-tip-info">';if(f.titleName){e+='<p class="message-main-title">'+f.titleName+"</p>"}if(f.hasCloseBtn){e+='<a class="rt-close-btn-wrap"><p class="message-close-btn"></p></a>'}e+='<div class="message-txt-wrapper"><div class="txt-max-height">';if(f.subtitle){e+='<p class="message-subtitle">'+f.subtitle+"</p>"}if(f.messageColor){e+='<p class="message-txt" style="color:'+f.messageColor+'">'+f.message+"</p></div></div>"}else{e+='<p class="message-txt">'+f.message+"</p></div></div>"}e+='<div class="freedom-add-wrap"></div>';e+="   </div>";if(f.hasBtns&&f.btnNum&&f.btnNum==1){e+='   <div class="one-btn-tip-btn">'+f.btns.okTxt+"</div>"}else{if(f.hasBtns&&f.btnNum&&f.btnNum==2){e+='<div class="choose-box-btn">';if(f.btnsReverse){e+='<a class="btn-sure" id="'+f.okBtnId+'">'+f.btns.okTxt+"</a>";e+='<a class="btn-close">'+f.btns.cancelTxt+"</a>"}else{e+='<a class="btn-close">'+f.btns.cancelTxt+"</a>";e+='<a class="btn-sure" id="'+f.okBtnId+'">'+f.btns.okTxt+"</a>"}e+="</div>"}}e+=" </div></div>";break;default:break}return e}};d.extend=function(g,f){for(var e in f){if(f[e]!==undefined){g[e]=f[e]}}};d.extend(d,{judgeOptsValFn:function(f,e){if(f==undefined){return e}else{return f}}});return d})();c.toast=function(d){c(document.body).toast(d)}})($);var krystal=window.krystal||{};krystal.layerBottom=(function(){var a,e,d;var b={noDefault:function(f){f.preventDefault()},noPropagation:function(f){f.stopPropagation()}};var c={init:function(f){this.strHtml=f.html;this.closeEle=f.closeEle;this.closeFn=f.closeFn;this.scrollElement=f.scrollElement;this.extraSpace=f.extraSpace;this.minRatio=f.minRatio||null;this.maxRatio=f.maxRatio||null;a=document.documentElement.clientHeight||document.body.clientHeight;e=document.createElement("div");e.classList.add("mask-below");document.documentElement.appendChild(e);d=document.createElement("div");d.classList.add("pop-win-base");d.classList.add("init-pop-win");this.minRatio&&(d.style.minHeight=a*this.minRatio+"px");this.maxRatio&&(d.style.maxHeight=a*+"px");this.boxContent(this.strHtml)},boxContent:function(f){d.innerHTML=f;this.assembleDom();this.scrollEle=d.querySelector(this.scrollElement);this.minRatio&&(this.scrollEle.style.minHeight=(a*this.minRatio-this.extraSpace)+"px");this.maxRatio&&(this.scrollEle.style.maxHeight=(a*this.maxRatio-this.extraSpace)+"px");this.scrollEle.style.overflow="auto";this.scrollEle.style.WebkitOverflowScrolling="touch";this.scrollEle.style.overflowScrolling="touch"},assembleDom:function(){document.documentElement.appendChild(d);setTimeout(function(){d.classList.add("pop-win-show")},30);this.bindEvts()},bindEvts:function(){var g=this;var f=d.querySelector(g.closeEle);f.addEventListener("click",function(){g.closePopWin.call(g,false);g.closeFn&&g.closeFn()},false);e.addEventListener("click",this.closePopWin.bind(this,false),false)},closePopWin:function(f){d.classList.add("pop-win-hide");var g=setTimeout(function(){e.parentNode.removeChild(e);d.parentNode.removeChild(d);if(f){window.location.reload()}clearTimeout(g)},200);this.move()},stopScroll:function(){document.addEventListener("scroll",b.noDefault,false)},move:function(){document.removeEventListener("scroll",b.noDefault,false)}};return{init:function(f){c.init(f);c.stopScroll()},closeBox:function(f){c.closePopWin(f)},getScrollContainer:function(){return c.scrollEle}}})();
